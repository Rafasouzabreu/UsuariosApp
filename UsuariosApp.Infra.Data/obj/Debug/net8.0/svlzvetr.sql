IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
GO

CREATE TABLE [PERFIL] (
    [ID] uniqueidentifier NOT NULL,
    [NOME] nvarchar(50) NOT NULL,
    CONSTRAINT [PK_PERFIL] PRIMARY KEY ([ID])
);
GO

CREATE TABLE [USUARIO] (
    [ID] uniqueidentifier NOT NULL,
    [NOME] nvarchar(150) NOT NULL,
    [EMAIL] nvarchar(50) NOT NULL,
    [SENHA] nvarchar(100) NOT NULL,
    CONSTRAINT [PK_USUARIO] PRIMARY KEY ([ID])
);
GO

CREATE TABLE [USUARIO_PERFIL] (
    [USUARIO_ID] uniqueidentifier NOT NULL,
    [PERFIL_ID] uniqueidentifier NOT NULL,
    CONSTRAINT [PK_USUARIO_PERFIL] PRIMARY KEY ([USUARIO_ID], [PERFIL_ID]),
    CONSTRAINT [FK_USUARIO_PERFIL_PERFIL_PERFIL_ID] FOREIGN KEY ([PERFIL_ID]) REFERENCES [PERFIL] ([ID]) ON DELETE NO ACTION,
    CONSTRAINT [FK_USUARIO_PERFIL_USUARIO_USUARIO_ID] FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIO] ([ID]) ON DELETE NO ACTION
);
GO

CREATE UNIQUE INDEX [IX_PERFIL_NOME] ON [PERFIL] ([NOME]);
GO

CREATE UNIQUE INDEX [IX_USUARIO_EMAIL] ON [USUARIO] ([EMAIL]);
GO

CREATE INDEX [IX_USUARIO_PERFIL_PERFIL_ID] ON [USUARIO_PERFIL] ([PERFIL_ID]);
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240906003604_Initial', N'8.0.8');
GO

COMMIT;
GO

